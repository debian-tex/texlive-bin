From 5f3bdcf598ba63825f84cdb675dba3195159111c Mon Sep 17 00:00:00 2001
From: Karl Berry <karl@freefriends.org>
Date: Thu, 17 May 2018 22:30:42 +0000
Subject: [PATCH 02/20] tinker with tests (pdftex r802), no svn:keywords for TL

git-svn-id: svn://tug.org/texlive/trunk/Build/source@47742 c570f23f-e606-0410-a88d-b1316a301751
---
 texk/web2c/pdftexdir/expanded.test |  2 +-
 texk/web2c/pdftexdir/pdfimage.test | 16 +++++++---------
 texk/web2c/pdftexdir/pdftex.test   | 11 ++++++-----
 texk/web2c/pdftexdir/pdftosrc.test |  2 +-
 texk/web2c/pdftexdir/ttf2afm.test  |  2 +-
 texk/web2c/pdftexdir/wprob.test    | 16 ++++++++++------
 6 files changed, 26 insertions(+), 23 deletions(-)

diff --git a/texk/web2c/pdftexdir/expanded.test b/texk/web2c/pdftexdir/expanded.test
index 819b09bf6..f07d5ad58 100755
--- a/texk/web2c/pdftexdir/expanded.test
+++ b/texk/web2c/pdftexdir/expanded.test
@@ -1,5 +1,5 @@
 #! /bin/sh -vx
-# $Id$
+# $Id: expanded.test 804 2018-05-17 22:29:15Z karl $
 # Public domain
 # David Carlisle: version for \expanded based on existing test scripts
 # by Peter Breitenlohner and Karl Berry.
diff --git a/texk/web2c/pdftexdir/pdfimage.test b/texk/web2c/pdftexdir/pdfimage.test
index e0d73e15b..d41d1f6c9 100755
--- a/texk/web2c/pdftexdir/pdfimage.test
+++ b/texk/web2c/pdftexdir/pdfimage.test
@@ -1,17 +1,15 @@
 #! /bin/sh -vx
-# $Id$
-# Copyright 2017 Karl Berry <tex-live@tug.org>#
+# $Id: pdfimage.test 804 2018-05-17 22:29:15Z karl $
+# Copyright 2017-2018 Karl Berry <tex-live@tug.org>#
 # Copyright 2013 Peter Breitenlohner <tex-live@tug.org>
 # You may freely use, modify and/or distribute this file.
 
-TEXMFCNF=$srcdir/../kpathsea
-TEXINPUTS=$srcdir/pdftexdir/tests:$srcdir/tests
-TEXFORMATS=.
+TEXMFCNF=$srcdir/../kpathsea; export TEXMFCNF
+TEXINPUTS=$srcdir/pdftexdir/tests:$srcdir/tests; export TEXINPUTS
+TEXFORMATS=.; export TEXFORMATS
 
-export TEXMFCNF TEXINPUTS TEXFORMATS
+./pdftex -ini -interaction=batchmode pdfimage </dev/null || exit 1
 
-./pdftex -ini pdfimage || exit 1
-
-./pdftex -fmt=pdfimage pdfimage || exit 1
+./pdftex -fmt=pdfimage -interaction=batchmode pdfimage </dev/null || exit 1
 
 exit 0
diff --git a/texk/web2c/pdftexdir/pdftex.test b/texk/web2c/pdftexdir/pdftex.test
index bce3f1779..0bd27896d 100755
--- a/texk/web2c/pdftexdir/pdftex.test
+++ b/texk/web2c/pdftexdir/pdftex.test
@@ -1,10 +1,11 @@
 #! /bin/sh -vx
-# $Id$
-# Copyright 2017 Karl Berry <tex-live@tug.org>
+# $Id: pdftex.test 804 2018-05-17 22:29:15Z karl $
+# Copyright 2017-2018 Karl Berry <tex-live@tug.org>
 # Copyright 2010 Peter Breitenlohner <tex-live@tug.org>
 # You may freely use, modify and/or distribute this file.
 
-# Not really a test, just making sure the program executes.
-
-./pdftex -version || exit 1
+# Make sure the program executes.
 
+./pdftex --version || exit 1
+./pdftex --help || exit 1
+exit 0
diff --git a/texk/web2c/pdftexdir/pdftosrc.test b/texk/web2c/pdftexdir/pdftosrc.test
index defd105b6..e93c3e83e 100755
--- a/texk/web2c/pdftexdir/pdftosrc.test
+++ b/texk/web2c/pdftexdir/pdftosrc.test
@@ -1,5 +1,5 @@
 #! /bin/sh -vx
-# $Id$
+# $Id: pdftosrc.test 804 2018-05-17 22:29:15Z karl $
 # Copyright 2017 Karl Berry <tex-live@tug.org>
 # Copyright 2011 Peter Breitenlohner <tex-live@tug.org>
 # You may freely use, modify and/or distribute this file.
diff --git a/texk/web2c/pdftexdir/ttf2afm.test b/texk/web2c/pdftexdir/ttf2afm.test
index 12ffcbfe7..ac9ce8333 100755
--- a/texk/web2c/pdftexdir/ttf2afm.test
+++ b/texk/web2c/pdftexdir/ttf2afm.test
@@ -1,5 +1,5 @@
 #! /bin/sh -vx
-# $Id$
+# $Id: ttf2afm.test 804 2018-05-17 22:29:15Z karl $
 # Copyright 2017 Karl Berry <tex-live@tug.org>#
 # Copyright 2013 Peter Breitenlohner <tex-live@tug.org>
 # You may freely use, modify and/or distribute this file.
diff --git a/texk/web2c/pdftexdir/wprob.test b/texk/web2c/pdftexdir/wprob.test
index 8ec3e093b..893e65316 100755
--- a/texk/web2c/pdftexdir/wprob.test
+++ b/texk/web2c/pdftexdir/wprob.test
@@ -1,15 +1,19 @@
 #! /bin/sh -vx
-# $Id$
-# Copyright 2017 Karl Berry <tex-live@tug.org>
+# $Id: wprob.test 804 2018-05-17 22:29:15Z karl $
+# Copyright 2017-2018 Karl Berry <tex-live@tug.org>
 # Copyright 2011-2013 Peter Breitenlohner <tex-live@tug.org>
 # You may freely use, modify and/or distribute this file.
 
 rm -rf pwprob.*
-cp $srcdir/tests/wprob.tex ./pwprob.tex
+cp "$srcdir/tests/wprob.tex" ./pwprob.tex || exit 1
 
-TEXMFCNF=$srcdir/../kpathsea \
-	./pdftex --ini --etex --file-line-error --interaction=nonstopmode pwprob.tex
+TEXMFCNF=$srcdir/../kpathsea; export TEXMFCNF
+
+# this command is expected to fail.
+./pdftex --ini --etex --file-line-error --interaction=nonstopmode pwprob.tex \
+&& exit 1
 
 grep '^\./pwprob\.tex:12: Could not open file NoSuchFile\.eps\.$' \
-	pwprob.log || exit 1
+  pwprob.log || exit 1
 
+exit 0
-- 
2.17.0

