From 6ba38e9e20afcb5395c7bc433b1a3597e2d07872 Mon Sep 17 00:00:00 2001
From: Karl Berry <karl@freefriends.org>
Date: Sat, 1 Jun 2019 16:01:23 +0000
Subject: [PATCH 4/7] psdefs.cpp patch since GS_PDF_ProcSet was removed in
 gs-9.27

svn 51285
---
 texk/dvisvgm/TLpatches/ChangeLog       |  4 ++++
 texk/dvisvgm/TLpatches/patch-10-psdefs | 19 +++++++++++++++++++
 2 files changed, 23 insertions(+)
 create mode 100644 texk/dvisvgm/TLpatches/patch-10-psdefs

diff --git a/texk/dvisvgm/TLpatches/ChangeLog b/texk/dvisvgm/TLpatches/ChangeLog
index 4ca80090c..682dfc104 100644
--- a/texk/dvisvgm/TLpatches/ChangeLog
+++ b/texk/dvisvgm/TLpatches/ChangeLog
@@ -1,3 +1,7 @@
+2019-06-01  Karl Berry  <karl@freefriends.org>
+
+	* patch-10-psdefs: from Akira.
+
 2019-03-26  Karl Berry  <karl@freefriends.org>
 
 	* patch-09-woff-zlib: new file. From Mojca and Martin,
diff --git a/texk/dvisvgm/TLpatches/patch-10-psdefs b/texk/dvisvgm/TLpatches/patch-10-psdefs
new file mode 100644
index 000000000..82690ddc3
--- /dev/null
+++ b/texk/dvisvgm/TLpatches/patch-10-psdefs
@@ -0,0 +1,19 @@
+dvisvgm does not work with gs-9.27 because GS_PDF_ProcSet was removed in
+gs-9.27.
+
+--- psdefs.cpp.orig	Mon Mar 11 03:21:29 2019
++++ psdefs.cpp	Thu May 30 08:06:00 2019
+@@ -107,8 +107,8 @@
+ "dmode sysexec<</Normal 0/Compatible 0/Multiply 1/Screen 2/Overlay 3/SoftLight "
+ "4/HardLight 5/ColorDodge 6/ColorBurn 7/Darken 8/Lighten 9/Difference 10/Exclus"
+ "ion 11/Hue 12/Saturation 13/Color 14/Luminosity 15/CompatibleOverprint 16>>exc"
+-"h get 1(setblendmode)prcmd}def/@pdfpagecount{GS_PDF_ProcSet begin pdfdict begi"
+-"n(r)file pdfopen begin pdfpagecount currentdict pdfclose end end end}def/@pdfp"
+-"agebox{GS_PDF_ProcSet begin pdfdict begin(r)file pdfopen begin dup dup 1 lt ex"
+-"ch pdfpagecount gt or{pop}{pdfgetpage/MediaBox pget pop aload pop}ifelse curre"
+-"ntdict pdfclose end end end}def DELAYBIND{.bindnow}if ";
++"h get 1(setblendmode)prcmd}def/@pdfpagecount{(r)file runpdfbe"
++"gin pdfpagecount runpdfend}def/@pdfp"
++"agebox{(r)file runpdfbegin dup dup 1 lt ex"
++"ch pdfpagecount gt or{pop}{pdfgetpage/MediaBox pget pop aload pop}ifelse runpd"
++"fend}def DELAYBIND{.bindnow}if ";
-- 
2.22.0

