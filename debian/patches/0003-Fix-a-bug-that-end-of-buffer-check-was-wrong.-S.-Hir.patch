From 4ba5b81d54ecb57331eb4484890a22a3f84de495 Mon Sep 17 00:00:00 2001
From: Akira Kakuto <kakuto@fuk.kindai.ac.jp>
Date: Sat, 1 Jun 2019 09:54:21 +0000
Subject: [PATCH 3/7] Fix a bug that end of buffer check was wrong. (S. Hirata)

svn 51284
---
 texk/dvipdfm-x/ChangeLog | 4 ++++
 texk/dvipdfm-x/unicode.c | 2 +-
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/texk/dvipdfm-x/ChangeLog b/texk/dvipdfm-x/ChangeLog
index 2acbde196..cb4eb2b55 100644
--- a/texk/dvipdfm-x/ChangeLog
+++ b/texk/dvipdfm-x/ChangeLog
@@ -1,3 +1,7 @@
+2019-06-01  Shunsaku Hirata  <shunsaku.hirata74@gmail.com>
+
+	* unicode.c: Fix a bug that end of buffer check was wrong.
+
 2019-05-26  Shunsaku Hirata  <shunsaku.hirata74@gmail.com>
 
 	* cmap_write.c, dvipdfmx.c, pdfdev.c, pdfdev.h, pdfdoc.c
diff --git a/texk/dvipdfm-x/unicode.c b/texk/dvipdfm-x/unicode.c
index 981fc123a..9fc79c220 100644
--- a/texk/dvipdfm-x/unicode.c
+++ b/texk/dvipdfm-x/unicode.c
@@ -78,7 +78,7 @@ UC_UTF16BE_is_valid_string (const unsigned char *p, const unsigned char *endptr)
 int
 UC_UTF8_is_valid_string (const unsigned char *p, const unsigned char *endptr)
 {
-  if (p + 1 >= endptr)
+  if (p >= endptr)
    return 0;
   while (p < endptr) {
     int32_t ucv = UC_UTF8_decode_char(&p, endptr);
-- 
2.22.0

