
if [ -n "$1" ] ; then
  svnroot="$1"
else
  svnroot=/src/TeX/texlive-svn/Build/source
fi
baseyear=2014

svni=$(cd $svnroot ; svn info | grep "^Last Changed Rev" | awk '{print$4}')
verstr=texlive-bin-$baseyear.`date +%Y%m%d`.$svni
pkgstr=texlive-bin_$baseyear.`date +%Y%m%d`.$svni

if [ -r $verstr ] ; then
  echo "already existing: $verstr, exit!"
  exit 1
fi

svnstat=$(cd $svnroot ; svn status --no-ignore)
if [ -n "$svnstat" ] ; then
  echo "Strange files present, stopping!"
  echo $svnstat
  exit 1
fi

echo "copying"
cp -a $svnroot $verstr
rm -rf $verstr/inst
rm -rf $verstr/Work
# packaged separately:
rm -rf $verstr/utils/biber
rm -rf $verstr/utils/asymptote
rm -rf $verstr/utils/pmx
rm -rf $verstr/utils/m-tx
rm -rf $verstr/utils/xindy
rm -rf $verstr/utils/ps2eps
rm -rf $verstr/utils/t1utils
#
# remove system libraries, keep only teckit and lua52 and libpng
# teckit: not in Debian
# lua52: system usage not supported in TeX Live
# libpng >= 1.4 is not available in Debian/unstable
# and depending libs are not compiled against it, 
# as bad as it is, we have to keep 
#	cairo freetype2 gd libpng
# poppler is currently too old in Debian, keep it
#	poppler

for i in \
	graphite2	\
	gmp		\
	harfbuzz	\
	icu		\
	libpaper	\
	mpfr		\
	pixman		\
	potrace		\
	xpdf		\
	zlib		\
	zziplib		\
	; do
  rm -rf $verstr/libs/$i
done
find $verstr -name \.svn -exec rm -rf '{}' \;
find $verstr -name autom4te.cache -exec rm -rf '{}' \;

echo "packing up"
tar -cJf $pkgstr.orig.tar.xz $verstr

