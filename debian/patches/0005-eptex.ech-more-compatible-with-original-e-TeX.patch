From 440077589fa81f4513e1ce76616a24eaea501ca0 Mon Sep 17 00:00:00 2001
From: Hironobu Yamashita <h.y.acetaminophen@gmail.com>
Date: Sun, 21 Jul 2019 06:43:32 +0000
Subject: [PATCH 05/10] eptex.ech: more compatible with original e-TeX

git-svn-id: svn://tug.org/texlive/trunk/Build/source@51694 c570f23f-e606-0410-a88d-b1316a301751
---
 texk/web2c/eptexdir/ChangeLog | 6 ++++++
 texk/web2c/eptexdir/eptex.ech | 6 +++---
 2 files changed, 9 insertions(+), 3 deletions(-)

diff --git a/texk/web2c/eptexdir/ChangeLog b/texk/web2c/eptexdir/ChangeLog
index 35b6877d0..fd82e6d1b 100644
--- a/texk/web2c/eptexdir/ChangeLog
+++ b/texk/web2c/eptexdir/ChangeLog
@@ -1,3 +1,9 @@
+2019-07-21  Hironobu Yamashita  <h.y.acetaminophen@gmail.com>
+
+	* eptex.ech: More compatible with original e-TeX, because
+	'\fontchar??' and '\iffontchar' for Latin font is effective
+	only for 0--255.
+
 2019-07-09  Hironori Kitagawa  <h_kitagawa2001@yahoo.co.jp>
 
 	* pdfutils.ch: Add primitive \ifincsname.
diff --git a/texk/web2c/eptexdir/eptex.ech b/texk/web2c/eptexdir/eptex.ech
index bd62a7ba2..2c7fe7b4e 100644
--- a/texk/web2c/eptexdir/eptex.ech
+++ b/texk/web2c/eptexdir/eptex.ech
@@ -553,7 +553,7 @@ font_char_ic_code: begin scan_font_ident; q:=cur_val;
       end
     else cur_val:=0;
     end
-  else begin scan_char_num;
+  else begin scan_ascii_num;
     if (font_bc[q]<=cur_val)and(font_ec[q]>=cur_val) then
       begin i:=orig_char_info(q)(qi(cur_val));
       case m of
@@ -646,7 +646,7 @@ if_font_char_code:begin scan_font_ident; n:=cur_val; scan_char_num;
   end;
 @y
 if_font_char_code:begin scan_font_ident; n:=cur_val;
-  if font_dir[n]<>dir_default then
+  if font_dir[n]<>dir_default then {Japanese font}
     begin scan_int;
     if cur_val>=0 then b:=is_char_kanji(cur_val)
     { In u\pTeX, $\hbox{|is_char_kanji|} = \lambda x\mathpunct{.} x\ge 0$ }
@@ -655,7 +655,7 @@ if_font_char_code:begin scan_font_ident; n:=cur_val;
       b:=(font_bc[n]<=cur_val)and(font_ec[n]>=cur_val)
       end
     end
-  else begin scan_char_num;
+  else begin scan_ascii_num;
     if (font_bc[n]<=cur_val)and(font_ec[n]>=cur_val) then @/
       b:=char_exists(orig_char_info(n)(qi(cur_val)))
     else b:=false;
-- 
2.23.0.rc1

