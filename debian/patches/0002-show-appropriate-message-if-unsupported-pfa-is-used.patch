From 07a3c68d8510070f783ece39fa9f0a104d354edb Mon Sep 17 00:00:00 2001
From: Akira Kakuto <kakuto@fuk.kindai.ac.jp>
Date: Sun, 8 Sep 2019 06:09:03 +0000
Subject: [PATCH 2/3] show appropriate message if unsupported pfa is used

git-svn-id: svn://tug.org/texlive/trunk/Build/source@52052 c570f23f-e606-0410-a88d-b1316a301751
---
 texk/dvipdfm-x/ChangeLog |  6 ++++++
 texk/dvipdfm-x/dvi.c     | 13 ++++++++++---
 2 files changed, 16 insertions(+), 3 deletions(-)

diff --git a/texk/dvipdfm-x/ChangeLog b/texk/dvipdfm-x/ChangeLog
index 5ab638ef3..8617dc338 100644
--- a/texk/dvipdfm-x/ChangeLog
+++ b/texk/dvipdfm-x/ChangeLog
@@ -1,3 +1,9 @@
+2019-09-08  Akira Kakuto  <kakuto@w32tex.org>
+
+	* dvi.c: Show appropriate message if unsupported pfa
+	is used. Reported in
+	https://tug.org/pipermail/dvipdfmx/2019-September/000031.html.
+
 2019-08-24  Shunsaku Hirata  <shunsaku.hirata74@gmail.com>
 
 	* dpxutil.c: Timezone offset is incremented by 1 hour if
diff --git a/texk/dvipdfm-x/dvi.c b/texk/dvipdfm-x/dvi.c
index fb2ce8b35..1fcc2e75f 100644
--- a/texk/dvipdfm-x/dvi.c
+++ b/texk/dvipdfm-x/dvi.c
@@ -1,6 +1,6 @@
 /* This is dvipdfmx, an eXtended version of dvipdfm by Mark A. Wicks.
 
-    Copyright (C) 2002-2018 by Jin-Hwan Cho and Shunsaku Hirata,
+    Copyright (C) 2002-2019 by Jin-Hwan Cho and Shunsaku Hirata,
     the dvipdfmx project team.
 
     Copyright (C) 2012-2015 by Khaled Hosny <khaledhosny@eglug.org>
@@ -921,8 +921,15 @@ dvi_locate_font (const char *tfm_name, spt_t ptsize)
         WARN(">> Please check if kpathsea library can find this font: %s", mrec1->font_name);
       }
     } else if (mrec && !mrec->map_name) {
-      WARN(">> This font is mapped to a physical font \"%s\".", mrec->font_name);
-      WARN(">> Please check if kpathsea library can find this font: %s", mrec->font_name);
+      char *finaldot = strrchr(mrec->font_name, '.');
+      if (finaldot && strcasecmp(finaldot, ".pfa") == 0) {
+        /* type1 fonts with pfa format are not supported */
+        WARN("This font is mapped to a physical font \"%s\".", mrec->font_name);
+        ERROR("Sorry, pfa format not supported; please convert the font to pfb, e.g., with t1binary.");
+      } else {
+        WARN(">> This font is mapped to a physical font \"%s\".", mrec->font_name);
+        WARN(">> Please check if kpathsea library can find this font: %s", mrec->font_name);
+      }
     } else {
       WARN(">> There are no valid font mapping entry for this font.");
       WARN(">> Font file name \"%s\" was assumed but failed to locate that font.", tfm_name);
-- 
2.23.0

