

svnroot=/src/TeX/texlive-svn/Build
baseyear=2013

svni=$(cd $svnroot ; svn info | grep ^Revision | awk '{print$2}')
verstr=texlive-bin-$baseyear.`date +%Y%m%d`.$svni
pkgstr=texlive-bin_$baseyear.`date +%Y%m%d`.$svni

if [ -r $verstr ] ; then
  echo "already existing: $verstr, exit!"
  exit 1
fi
echo "copying"
cp -a $svnroot/source $verstr
rm -rf $verstr/inst
rm -rf $verstr/Work
rm -rf $verstr/utils/biber/bin
#
# remove system libraries, keep only teckit and harfbuzz
# harfbuzz is needed as harfbuzz is not linked against graphite2
# so xetex building breaks with system harfbuzz libs
for i in cairo freetype freetype2 gd graphite2 icu libpng pixman poppler t1lib xpdf zlib zziplib ; do
  rm -rf $verstr/libs/$i
done
find $verstr -name \.svn -exec rm -rf '{}' \;
find $verstr -name autom4te.cache -exec rm -rf '{}' \;

echo "packing up"
tar -cJf $pkgstr.orig.tar.xz $verstr

