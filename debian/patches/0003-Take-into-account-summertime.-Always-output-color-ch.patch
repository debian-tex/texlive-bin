From ff9688153d6d9d944d57c5d77479866dab1b5553 Mon Sep 17 00:00:00 2001
From: Akira Kakuto <kakuto@fuk.kindai.ac.jp>
Date: Sat, 24 Aug 2019 10:48:43 +0000
Subject: [PATCH 3/3] Take into account summertime. Always output color change
 code. (S. Hirata)

git-svn-id: svn://tug.org/texlive/trunk/Build/source@51948 c570f23f-e606-0410-a88d-b1316a301751
---
 texk/dvipdfm-x/ChangeLog    | 10 ++++++++++
 texk/dvipdfm-x/configure    | 22 +++++++++++-----------
 texk/dvipdfm-x/configure.ac |  2 +-
 texk/dvipdfm-x/dpxutil.c    |  5 ++++-
 texk/dvipdfm-x/pdfcolor.c   |  6 +++---
 5 files changed, 29 insertions(+), 16 deletions(-)

diff --git a/texk/dvipdfm-x/ChangeLog b/texk/dvipdfm-x/ChangeLog
index de3e908f7..5ab638ef3 100644
--- a/texk/dvipdfm-x/ChangeLog
+++ b/texk/dvipdfm-x/ChangeLog
@@ -1,3 +1,13 @@
+2019-08-24  Shunsaku Hirata  <shunsaku.hirata74@gmail.com>
+
+	* dpxutil.c: Timezone offset is incremented by 1 hour if
+	tm_isdst > 0, as suggested in
+	https://tug.org/pipermail/dvipdfmx/2019-July/000017.html
+	* pdfcolor.c: Always output color change instruction when color
+	push/pop is invoked. Fix for the issue reported in
+	https://tug.org/pipermail/dvipdfmx/2019-August/000029.html
+	* configure.ac: Version 20190824.
+
 2019-08-17  Shunsaku Hirata  <shunsaku.hirata74@gmail.com>
 
 	* pdfdoc.c, spc_pdfm.c: Workaround for some problems reported
diff --git a/texk/dvipdfm-x/configure b/texk/dvipdfm-x/configure
index dc1306c67..509f85511 100755
--- a/texk/dvipdfm-x/configure
+++ b/texk/dvipdfm-x/configure
@@ -1,6 +1,6 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.69 for dvipdfm-x (TeX Live) 20190817.
+# Generated by GNU Autoconf 2.69 for dvipdfm-x (TeX Live) 20190824.
 #
 # Report bugs to <dvipdfmx@tug.org>.
 #
@@ -590,8 +590,8 @@ MAKEFLAGS=
 # Identity of this package.
 PACKAGE_NAME='dvipdfm-x (TeX Live)'
 PACKAGE_TARNAME='dvipdfm-x--tex-live-'
-PACKAGE_VERSION='20190817'
-PACKAGE_STRING='dvipdfm-x (TeX Live) 20190817'
+PACKAGE_VERSION='20190824'
+PACKAGE_STRING='dvipdfm-x (TeX Live) 20190824'
 PACKAGE_BUGREPORT='dvipdfmx@tug.org'
 PACKAGE_URL=''
 
@@ -1350,7 +1350,7 @@ if test "$ac_init_help" = "long"; then
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures dvipdfm-x (TeX Live) 20190817 to adapt to many kinds of systems.
+\`configure' configures dvipdfm-x (TeX Live) 20190824 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
@@ -1421,7 +1421,7 @@ fi
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of dvipdfm-x (TeX Live) 20190817:";;
+     short | recursive ) echo "Configuration of dvipdfm-x (TeX Live) 20190824:";;
    esac
   cat <<\_ACEOF
 
@@ -1551,7 +1551,7 @@ fi
 test -n "$ac_init_help" && exit $ac_status
 if $ac_init_version; then
   cat <<\_ACEOF
-dvipdfm-x (TeX Live) configure 20190817
+dvipdfm-x (TeX Live) configure 20190824
 generated by GNU Autoconf 2.69
 
 Copyright (C) 2012 Free Software Foundation, Inc.
@@ -2390,7 +2390,7 @@ cat >config.log <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by dvipdfm-x (TeX Live) $as_me 20190817, which was
+It was created by dvipdfm-x (TeX Live) $as_me 20190824, which was
 generated by GNU Autoconf 2.69.  Invocation command line was
 
   $ $0 $@
@@ -8077,7 +8077,7 @@ fi
 
 # Define the identity of the package.
  PACKAGE='dvipdfm-x--tex-live-'
- VERSION='20190817'
+ VERSION='20190824'
 
 
 cat >>confdefs.h <<_ACEOF
@@ -14746,7 +14746,7 @@ Usage: $0 [OPTIONS]
 Report bugs to <bug-libtool@gnu.org>."
 
 lt_cl_version="\
-dvipdfm-x (TeX Live) config.lt 20190817
+dvipdfm-x (TeX Live) config.lt 20190824
 configured by $0, generated by GNU Autoconf 2.69.
 
 Copyright (C) 2011 Free Software Foundation, Inc.
@@ -16636,7 +16636,7 @@ cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
 # report actual input values of CONFIG_FILES etc. instead of their
 # values after options handling.
 ac_log="
-This file was extended by dvipdfm-x (TeX Live) $as_me 20190817, which was
+This file was extended by dvipdfm-x (TeX Live) $as_me 20190824, which was
 generated by GNU Autoconf 2.69.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
@@ -16706,7 +16706,7 @@ _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 ac_cs_config="`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`"
 ac_cs_version="\\
-dvipdfm-x (TeX Live) config.status 20190817
+dvipdfm-x (TeX Live) config.status 20190824
 configured by $0, generated by GNU Autoconf 2.69,
   with options \\"\$ac_cs_config\\"
 
diff --git a/texk/dvipdfm-x/configure.ac b/texk/dvipdfm-x/configure.ac
index 357c86f8b..fad7dd834 100644
--- a/texk/dvipdfm-x/configure.ac
+++ b/texk/dvipdfm-x/configure.ac
@@ -7,7 +7,7 @@ dnl   This file is free software; the copyright holder
 dnl   gives unlimited permission to copy and/or distribute it,
 dnl   with or without modifications, as long as this notice is preserved.
 dnl
-AC_INIT([dvipdfm-x (TeX Live)], [20190817], [dvipdfmx@tug.org])
+AC_INIT([dvipdfm-x (TeX Live)], [20190824], [dvipdfmx@tug.org])
 AC_PREREQ([2.65])
 AC_CONFIG_SRCDIR([agl.c])
 AC_CONFIG_AUX_DIR([../../build-aux])
diff --git a/texk/dvipdfm-x/dpxutil.c b/texk/dvipdfm-x/dpxutil.c
index 8f884b982..bc21c86ae 100644
--- a/texk/dvipdfm-x/dpxutil.c
+++ b/texk/dvipdfm-x/dpxutil.c
@@ -1,6 +1,6 @@
 /* This is dvipdfmx, an eXtended version of dvipdfm by Mark A. Wicks.
 
-    Copyright (C) 2002-2018 by Jin-Hwan Cho and Shunsaku Hirata,
+    Copyright (C) 2002-2019 by Jin-Hwan Cho and Shunsaku Hirata,
     the dvipdfmx project team.
 
     Copyright (C) 1998, 1999 by Mark A. Wicks <mwicks@kettering.edu>
@@ -163,6 +163,9 @@ dpx_util_format_asn_date (char *date_string, int need_timezone)
     tz_offset = 0;
   }
   if (need_timezone) {
+    if (bd_time->tm_isdst > 0) {
+      tz_offset += 3600;
+    }
     sprintf(date_string, "D:%04d%02d%02d%02d%02d%02d%c%02d'%02d'",
             bd_time->tm_year + 1900, bd_time->tm_mon + 1, bd_time->tm_mday,
             bd_time->tm_hour, bd_time->tm_min, bd_time->tm_sec,
diff --git a/texk/dvipdfm-x/pdfcolor.c b/texk/dvipdfm-x/pdfcolor.c
index 139cabe16..624480d5e 100644
--- a/texk/dvipdfm-x/pdfcolor.c
+++ b/texk/dvipdfm-x/pdfcolor.c
@@ -1,6 +1,6 @@
 /* This is dvipdfmx, an eXtended version of dvipdfm by Mark A. Wicks.
 
-    Copyright (C) 2002-2018 by Jin-Hwan Cho and Shunsaku Hirata,
+    Copyright (C) 2002-2019 by Jin-Hwan Cho and Shunsaku Hirata,
     the dvipdfmx project team.
     
     Copyright (C) 1998, 1999 by Mark A. Wicks <mwicks@kettering.edu>
@@ -345,7 +345,7 @@ pdf_color_set (pdf_color *sc, pdf_color *fc)
 {
   pdf_color_copycolor(&color_stack.stroke[color_stack.current], sc);
   pdf_color_copycolor(&color_stack.fill[color_stack.current], fc);
-  pdf_dev_reset_color(0);
+  pdf_dev_reset_color(1);
 }
 
 void
@@ -367,7 +367,7 @@ pdf_color_pop (void)
     WARN("Color stack underflow. Just ignore.");
   } else {
     color_stack.current--;
-    pdf_dev_reset_color(0);
+    pdf_dev_reset_color(1);
   }
   return;
 }
-- 
2.23.0

