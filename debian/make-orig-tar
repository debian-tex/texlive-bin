
if [ -n "$1" ] ; then
  svnroot="$1"
else
  svnroot=/src/TeX/texlive-svn/Build/source
fi
baseyear=2014

svni=$(cd $svnroot ; svn info | grep "^Last Changed Rev" | awk '{print$4}')
verstr=texlive-bin-$baseyear.`date +%Y%m%d`.$svni
pkgstr=texlive-bin_$baseyear.`date +%Y%m%d`.$svni

if [ -r $verstr ] ; then
  echo "already existing: $verstr, exit!"
  exit 1
fi
echo "copying"
cp -a $svnroot $verstr
rm -rf $verstr/inst
rm -rf $verstr/Work
rm -rf $verstr/utils/biber/bin
#
# remove system libraries, keep only teckit and lua52 and libpng
# teckit: not in Debian
# lua52: system usage not supported in TeX Live
# libpng etc needs libong >= 1.4, currently not in Debian
for i in \
	cairo		\
	freetype2	\
	gd		\
	graphite2	\
	harfbuzz	\
	icu		\
	libpng		\
	paper		\
	pixman		\
	poppler		\
	potrace		\
	xpdf		\
	zlib		\
	zziplib		\
  do
  rm -rf $verstr/libs/$i
done
find $verstr -name \.svn -exec rm -rf '{}' \;
find $verstr -name autom4te.cache -exec rm -rf '{}' \;

echo "packing up"
tar -cJf $pkgstr.orig.tar.xz $verstr

