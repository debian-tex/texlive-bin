---
 texk/web2c/Makefile.in                 |    9 ++++--
 texk/web2c/omegaware/ChangeLog         |    7 ++++
 texk/web2c/omegaware/am/omegaware.am   |    6 +++-
 texk/web2c/omegaware/overbmp.test      |   25 ++++++++++++++++
 texk/web2c/omegaware/ovp2ovf.up        |    6 ++++
 texk/web2c/omegaware/tests/inbmp0.opl  |   16 ++++++++++
 texk/web2c/omegaware/tests/overbmp.ovp |   49 +++++++++++++++++++++++++++++++++
 7 files changed, 114 insertions(+), 4 deletions(-)

--- texlive-bin.orig/texk/web2c/Makefile.in
+++ texlive-bin/texk/web2c/Makefile.in
@@ -1936,7 +1936,8 @@
 	omegaware/tests/ofontv4.vpl omegaware/tests/ofontv5.opl \
 	omegaware/tests/ofontv5.ovp omegaware/tests/ofontv6.opl \
 	omegaware/tests/ofontv6.ovp omegaware/tests/Cherokee.pl \
-	omegaware/tests/OCherokee.ovp omegaware/tests/realnum.opl \
+	omegaware/tests/OCherokee.ovp omegaware/tests/inbmp0.opl \
+	omegaware/tests/overbmp.ovp omegaware/tests/realnum.opl \
 	omegaware/tests/realnum.out omegaware/tests/repeat.opl \
 	omegaware/tests/repeated.opl omegaware/tests/sample.out \
 	omegaware/tests/sample.ovp omegaware/tests/sample0-h.opl \
@@ -2011,7 +2012,8 @@
 	ofont*vf omegaware/tests/xofont* omegaware/tests/Cherokee.tfm \
 	omegaware/tests/OCherokee.ofm omegaware/tests/OCherokee.opl \
 	omegaware/tests/OCherokee.ovf omegaware/tests/xCherokee.* \
-	omegaware/tests/xOCherokee.* ocftest.* \
+	omegaware/tests/xOCherokee.* \
+	omegaware/tests/inbmp1.* omegaware/tests/xoverbmp.* ocftest.* \
 	omegaware/tests/xrealnum.* omegaware/tests/xrepeated.* \
 	omegaware/tests/sample*.ofm omegaware/tests/sample*.ovf \
 	omegaware/tests/sample1-h.opl omegaware/tests/xsample*.out \
@@ -3011,7 +3013,8 @@
 	omegaware/otangle.test
 
 OMFONTS_tests = omegaware/level1.test omegaware/ofonts.test \
-	omegaware/omfonts.test omegaware/realnum.test omegaware/repeat.test \
+	omegaware/omfonts.test omegaware/overbmp.test\
+	omegaware/realnum.test omegaware/repeat.test \
 	omegaware/selectfont.test omegaware/specialhex.test
 
 al_tangle = WEBINPUTS=.:$(srcdir) AM_V_P=$(AM_V_P) $(SHELL) ./tangle-sh $@ $(OTANGLE)
--- texlive-bin.orig/texk/web2c/omegaware/ovp2ovf.up
+++ texlive-bin/texk/web2c/omegaware/ovp2ovf.up
@@ -44,3 +44,9 @@
 @y
 procedure read_packet(@!c:integer);
 @z
+
+@x [188]
+      while (not diff) and (cprime<=ec) do begin
+@y
+      while (not diff) and (cprime<=ec) and (cprime-c<@"10000) do begin
+@z
--- texlive-bin.orig/texk/web2c/omegaware/ChangeLog
+++ texlive-bin/texk/web2c/omegaware/ChangeLog
@@ -1,3 +1,10 @@
+2013-12-09  Peter Breitenlohner  <peb@mppmu.mpg.de>
+
+	* ovp2ovf.up: Ensure char_repeats[c]<=0xffff.
+	* overbmp.test, tests/inbmp0.opl, tests/overbmp.ovp (new):
+	Shell script and data for a new test,
+	inspired by TANAKA Takuji <KXD02663@nifty.ne.jp>.
+
 2013-12-06  Peter Breitenlohner  <peb@mppmu.mpg.de>
 
 	* opl2ofm.{ch,web}: Drop ASCII_04, ASCII_10, ASCII_14, MBL_string,
--- /dev/null
+++ texlive-bin/texk/web2c/omegaware/overbmp.test
@@ -0,0 +1,25 @@
+#! /bin/sh
+
+# Copyright (C) 2013 Peter Breitenlohner <tex-live@tug.org>
+# You may freely use, modify and/or distribute this file.
+
+tests=omegaware/tests
+
+test -d $tests || mkdir -p $tests
+
+TEXMFCNF=$srcdir/../kpathsea
+OFMFONTS=./$tests
+export TEXMFCNF OFMFONTS
+
+./opl2ofm -verbose $srcdir/$tests/inbmp0 $tests/inbmp1 || exit 1
+
+./ofm2opl -verbose inbmp1 $tests/inbmp1 || exit 1
+
+diff $srcdir/$tests/inbmp0.opl $tests/inbmp1.opl || exit 1
+
+./ovp2ovf -verbose $srcdir/$tests/overbmp.ovp $tests/xoverbmp || exit 1
+
+./ovf2ovp -verbose $tests/xoverbmp xoverbmp $tests/xoverbmp.ovp || exit 1
+
+diff $srcdir/$tests/overbmp.ovp $tests/xoverbmp.ovp || exit 1
+
--- texlive-bin.orig/texk/web2c/omegaware/am/omegaware.am
+++ texlive-bin/texk/web2c/omegaware/am/omegaware.am
@@ -102,7 +102,8 @@
 OTANGLE_tests = omegaware/odvicopy.test omegaware/odvitype.test \
 	omegaware/otangle.test
 OMFONTS_tests = omegaware/level1.test omegaware/ofonts.test \
-	omegaware/omfonts.test omegaware/realnum.test omegaware/repeat.test \
+	omegaware/omfonts.test omegaware/overbmp.test\
+	omegaware/realnum.test omegaware/repeat.test \
 	omegaware/selectfont.test omegaware/specialhex.test
 EXTRA_DIST += $(OTANGLE_tests) $(OMFONTS_tests)
 
@@ -145,6 +146,9 @@
 DISTCLEANFILES += omegaware/tests/Cherokee.tfm omegaware/tests/OCherokee.ofm \
 	omegaware/tests/OCherokee.opl omegaware/tests/OCherokee.ovf \
 	omegaware/tests/xCherokee.* omegaware/tests/xOCherokee.*
+## omegaware/overbmp.test
+EXTRA_DIST += omegaware/tests/inbmp0.opl omegaware/tests/overbmp.ovp
+DISTCLEANFILES += omegaware/tests/inbmp1.* omegaware/tests/xoverbmp.*
 ## omegaware/otangle.test
 DISTCLEANFILES += ocftest.*
 ## omegaware/realnum.test
--- /dev/null
+++ texlive-bin/texk/web2c/omegaware/tests/inbmp0.opl
@@ -0,0 +1,16 @@
+(OFMLEVEL H 0)
+(FONTDIR TL)
+(FAMILY UNSPECIFIED)
+(FACE F MRR)
+(CODINGSCHEME UNSPECIFIED)
+(DESIGNSIZE R 10.0)
+(COMMENT DESIGNSIZE IS IN POINTS)
+(COMMENT OTHER SIZES ARE MULTIPLES OF DESIGNSIZE)
+(CHECKSUM H AA6297E0)
+(SEVENBITSAFEFLAG FALSE)
+(CHARACTER H 4E00
+   (CHARWD R 1.0)
+   )
+(CHARACTER H 53F1
+   (CHARWD R 1.0)
+   )
--- /dev/null
+++ texlive-bin/texk/web2c/omegaware/tests/overbmp.ovp
@@ -0,0 +1,49 @@
+(VTITLE JVF with characters above the Basic Multilingual Plane)
+(OFMLEVEL H 1)
+(FONTDIR TL)
+(FAMILY UNSPECIFIED)
+(FACE F MRR)
+(CODINGSCHEME UNSPECIFIED)
+(DESIGNSIZE R 10.0)
+(COMMENT DESIGNSIZE IS IN POINTS)
+(COMMENT OTHER SIZES ARE MULTIPLES OF DESIGNSIZE)
+(CHECKSUM H DD8C3992)
+(SEVENBITSAFEFLAG FALSE)
+(MAPFONT D 0
+   (FONTNAME inbmp1)
+   (FONTCHECKSUM H AA6297E0)
+   (FONTAT R 1.0)
+   (FONTDSIZE R 10.0)
+   )
+(MAPFONT D 1
+   (FONTNAME xoverbmp)
+   (FONTCHECKSUM H DD8C3992)
+   (FONTAT R 1.0)
+   (FONTDSIZE R 10.0)
+   )
+(CHARACTER H 4E00
+   (CHARWD R 1.0)
+   (MAP
+      (SETCHAR H 4E00)
+      )
+   )
+(CHARACTER H 53F1
+   (CHARWD R 1.0)
+   (MAP
+      (SELECTFONT D 1)
+      (SETCHAR H 20B9F)
+      )
+   )
+(CHARACTER H 20B9F
+   (CHARWD R 1.0)
+   (MAP
+      (SELECTFONT D 1)
+      (SETCHAR H 20BB7)
+      )
+   )
+(CHARACTER H 20BB7
+   (CHARWD R 1.0)
+   (MAP
+      (SETCHAR H 53F1)
+      )
+   )
