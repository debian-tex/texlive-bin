# Makefile is generated by 'configure' from Makefile.in

#************************************************************************
#
#  Part of the dvipng distribution
#
#  This program is free software: you can redistribute it and/or modify
#  it under the terms of the GNU Lesser General Public License as
#  published by the Free Software Foundation, either version 3 of the
#  License, or (at your option) any later version.
#
#  This program is distributed in the hope that it will be useful, but
#  WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
#  Lesser General Public License for more details.
#
#  You should have received a copy of the GNU Lesser General Public
#  License along with this program. If not, see
#  <http://www.gnu.org/licenses/>.
#
#  Copyright (C) 2002-2008 Jan-Åke Larsson
#
#************************************************************************

PACKAGE_STRING="@PACKAGE_STRING@"

CC = @CC@
CFLAGS = @CFLAGS@ -Wall
CPPFLAGS = @CPPFLAGS@ -I.
LN_S = @LN_S@

LIBS = @LIBS@
LDFLAGS = @LDFLAGS@

srcdir = @srcdir@
VPATH = @srcdir@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
infodir = @infodir@
mandir = @mandir@
DESTDIR=
INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
MKINSTALLDIRS = $(srcdir)/mkinstalldirs

MAKEINFO=@MAKEINFO@ @MAKEINFO_MACROS@
INSTALL_INFO=@INSTALL_INFO@
TEX=tex
TEXIDVI=texi2dvi
TEXIHTML=texi2html
DVIPS=dvips
TEXIFILES = dvipng.texi readme.texi install.texi macros.texi dvipng.help

objects = dvipng.o color.o draw.o dvi.o font.o misc.o pk.o \
	set.o special.o papersiz.o ppagelist.o \
	vf.o @PSFONTS_O@

all: dvipng docs

install: @INSTALL_BIN_TARGET@   @INSTALL_BIN_TARGET@-docs

####################################### The program

dvipng: $(objects)
	$(CC) $(LDFLAGS) $(objects) -o dvipng $(LIBS) 

$(objects): dvipng.h commands.h config.h

install-dvipng: dvipng
	-$(MKINSTALLDIRS) $(DESTDIR)$(bindir)
	$(INSTALL) dvipng $(DESTDIR)$(bindir)

install-dvigif: install-dvipng
	(cd $(DESTDIR)$(bindir) && rm -f dvigif && $(LN_S) dvipng dvigif)

####################################### The documentation

docs: dvipng.dvi dvipng.info

dvipng.dvi: $(TEXIFILES)
	-$(TEXIDVI) -I $(srcdir) $(srcdir)/dvipng.texi

dvipng.ps: dvipng.dvi
	$(DVIPS) -Ppdf dvipng.dvi 

dvipng.info: $(TEXIFILES) dvipng.help
	-$(MAKEINFO) -I$(srcdir) $(srcdir)/dvipng.texi

dvipng.help: dvipng
	-./dvipng > dvipng.tmp
	( test -r dvipng.help && diff dvipng.tmp dvipng.help ) \
		|| cp dvipng.tmp dvipng.help
	rm -f dvipng.tmp

www: $(TEXIFILES) dvipng.help
	mkdir -p www
	texi2html -split chapter -nosec-nav -subdir html \
	   -I $(srcdir) $(srcdir)/dvipng.texi
	(cd html; for i in *; do \
	   sed -e "s/Jan-A/Jan-\&Aring\;/g" $$i > ../www/$$i; \
	done) 
	cp www/dvipng.html www/index.html
	rm -rf html

dvipng_mono.html: $(TEXIFILES) dvipng.help
	texi2html --monolithic -nomenu -nosec_nav -o dvipng_mono.html \
		 -I $(srcdir) $(srcdir)/dvipng.texi

install-docs: docs
	-$(MKINSTALLDIRS) $(DESTDIR)$(infodir)
	for x in dvipng.info* ; do \
		$(INSTALL_DATA) $$x $(DESTDIR)$(infodir) ; \
	done
	-$(INSTALL_INFO) --info-dir=$(DESTDIR)$(infodir) dvipng.info
	-$(MKINSTALLDIRS) $(DESTDIR)$(mandir)/man1
	$(INSTALL_DATA) $(srcdir)/dvipng.1 $(DESTDIR)$(mandir)/man1

install-dvipng-docs: install-docs

install-dvigif-docs: install-docs
	(cd $(DESTDIR)$(mandir)/man1 && rm -f dvigif.1 && $(LN_S) dvipng.1 dvigif.1)

####################################### The test

test: test_dvipng.dvi dvipng
	./dvipng -T tight -strict test_dvipng
	echo View the result e.g. with xv test_dvipng\*.png

test_dvipng.dvi: test_dvipng.tex
	latex $(srcdir)/test_dvipng.tex

####################################### The cleaning up

clean:
	rm -f *.o dvipng *.help *.info* *dvipng.dvi *.aux *.log
	rm -f *dvipng.ps *.cp *.fn *.ky *~ \#*\# \
		*.tp *.vr *.pg *.toc *.tp *.bak *.cps *.kys *.tps \
		*.fns *.vrs *.pgs *.html *.tmp

distclean: clean
	rm -f Makefile
	rm -f config.status config.log config.cache c-auto.h

####################################### Maintainer targets

INSTALL: install.texi
	-$(MAKEINFO) -D rawfile --no-headers --no-validate \
		--no-number-sections \
		-I$(srcdir) $(srcdir)/install.texi --output INSTALL

README: readme.texi
	-$(MAKEINFO) -D rawfile --no-headers --no-validate \
		--no-number-sections \
		-I$(srcdir) $(srcdir)/readme.texi --output README

dvipng.1: dvipng.texi readme.texi
	texi2pod.pl -D man $(srcdir)/dvipng.texi | \
	sed -es/@//g -es/previewlatex/preview-latex/g -es/{}//g > dvipng.pod
	pod2man --center="User commands" --release=$(PACKAGE_STRING)\
		dvipng.pod > dvipng.1
	rm dvipng.pod

dist: INSTALL README dvipng.1 distclean

# SunOS make suffix rule wierdness
.cps.h:

